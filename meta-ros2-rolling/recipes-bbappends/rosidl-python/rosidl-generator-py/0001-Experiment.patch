From 3396c4654f0d37018977c34039cbcfa2ca9d203f Mon Sep 17 00:00:00 2001
From: Matthias Schoepfer <matthias.schoepfer@googlemail.com>
Date: Thu, 4 Apr 2024 18:07:27 +0200
Subject: [PATCH] Experiment

Signed-off-by: Matthias Schoepfer <matthias.schoepfer@googlemail.com>
---
 cmake/register_py.cmake                             | 1 +
 cmake/rosidl_generator_py_generate_interfaces.cmake | 4 +++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/cmake/register_py.cmake b/cmake/register_py.cmake
index f31c534..fde46e5 100644
--- a/cmake/register_py.cmake
+++ b/cmake/register_py.cmake
@@ -17,6 +17,7 @@ macro(rosidl_generator_py_extras BIN GENERATOR_FILES TEMPLATE_DIR)
   # Make sure extension points are registered in order
   find_package(rosidl_generator_c QUIET REQUIRED)
   find_package(rosidl_typesupport_c QUIET REQUIRED)
+  find_package(Python3 QUIET REQUIRED COMPONENTS Development NumPy)
 
   ament_register_extension(
     "rosidl_generate_idl_interfaces"
diff --git a/cmake/rosidl_generator_py_generate_interfaces.cmake b/cmake/rosidl_generator_py_generate_interfaces.cmake
index 4b69283..f059167 100644
--- a/cmake/rosidl_generator_py_generate_interfaces.cmake
+++ b/cmake/rosidl_generator_py_generate_interfaces.cmake
@@ -244,12 +244,13 @@ set(PYTHON_EXECUTABLE ${_PYTHON_EXECUTABLE})
 
 # Depend on rosidl_generator_py generated targets from our dependencies
 foreach(_pkg_name ${rosidl_generate_interfaces_DEPENDENCY_PACKAGE_NAMES})
-  target_link_libraries(${_target_name_lib} ${${_pkg_name}_TARGETS${rosidl_generator_py_suffix}})
+  target_link_libraries(${_target_name_lib} ${${_pkg_name}_TARGETS${rosidl_generator_py_suffix}} Python3::Python Python3::NumPy)
 endforeach()
 
 set_target_properties(${_target_name_lib} PROPERTIES
   COMPILE_OPTIONS "${_extension_compile_flags}")
 if(NOT rosidl_generate_interfaces_SKIP_INSTALL)
+  
   install(TARGETS ${_target_name_lib}
     EXPORT export_${_target_name_lib}
     ARCHIVE DESTINATION lib
@@ -259,6 +260,7 @@ if(NOT rosidl_generate_interfaces_SKIP_INSTALL)
   # Export this target so downstream interface packages can depend on it
   rosidl_export_typesupport_targets("${rosidl_generator_py_suffix}" "${_target_name_lib}")
   ament_export_targets(export_${_target_name_lib})
+  ament_export_dependencies(Python3)
 endif()
 
 if(BUILD_TESTING AND rosidl_generate_interfaces_ADD_LINTER_TESTS)
-- 
2.43.2

